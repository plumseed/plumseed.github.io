<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/title_favicon_32.ico?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/title_favicon_32.ico?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/title_favicon_16.ico?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">
  <meta name="google-site-verification" content="3dBwV8OlVnNtYzxCLCFp2w8WMpuSecV7vBmA_zrf9j4">
  <meta name="baidu-site-verification" content="eoUZD1BDx6">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":"default"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="ä¸€ç¯‡å…³äº C++11 å³å€¼å¼•ç”¨çš„ä¸€ç¯‡æ€»ç»“ï¼Œè§‰å¾—å…¶ä¸­å¯¹äºå¸¸è§è¯¯ç”¨çš„æ€»ç»“å¾ˆä¸é”™ï¼Œæƒ³èµ·æ¥äº†å½“å¹´è‡ªå·±èµ°è¿‡çš„ä¸€äº›å‘ï¼Œè½¬è½½åšä¸ªè®°å½•ã€‚">
<meta name="keywords" content="C++11,å³å€¼å¼•ç”¨,ç§»åŠ¨,å®Œç¾è½¬å‘">
<meta property="og:type" content="article">
<meta property="og:title" content="C++ å³å€¼å¼•ç”¨ä½¿ç”¨æ€»ç»“">
<meta property="og:url" content="https://murphypei.github.io/blog/2020/02/right-reference.html">
<meta property="og:site_name" content="æ‹¾è’å¿—">
<meta property="og:description" content="ä¸€ç¯‡å…³äº C++11 å³å€¼å¼•ç”¨çš„ä¸€ç¯‡æ€»ç»“ï¼Œè§‰å¾—å…¶ä¸­å¯¹äºå¸¸è§è¯¯ç”¨çš„æ€»ç»“å¾ˆä¸é”™ï¼Œæƒ³èµ·æ¥äº†å½“å¹´è‡ªå·±èµ°è¿‡çš„ä¸€äº›å‘ï¼Œè½¬è½½åšä¸ªè®°å½•ã€‚">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-09-06T09:24:43.040Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C++ å³å€¼å¼•ç”¨ä½¿ç”¨æ€»ç»“">
<meta name="twitter:description" content="ä¸€ç¯‡å…³äº C++11 å³å€¼å¼•ç”¨çš„ä¸€ç¯‡æ€»ç»“ï¼Œè§‰å¾—å…¶ä¸­å¯¹äºå¸¸è§è¯¯ç”¨çš„æ€»ç»“å¾ˆä¸é”™ï¼Œæƒ³èµ·æ¥äº†å½“å¹´è‡ªå·±èµ°è¿‡çš„ä¸€äº›å‘ï¼Œè½¬è½½åšä¸ªè®°å½•ã€‚">
  <link rel="alternate" href="/atom.xml" title="æ‹¾è’å¿—" type="application/atom+xml">
  <link rel="canonical" href="https://murphypei.github.io/blog/2020/02/right-reference">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>C++ å³å€¼å¼•ç”¨ä½¿ç”¨æ€»ç»“ | æ‹¾è’å¿—</title>
  <meta name="generator" content="Hexo 3.9.0">
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ‹¾è’å¿—</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">è™šæ€€è‹¥è°·ï¼Œå¤§æ™ºè‹¥æ„š</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://murphypei.github.io/blog/2020/02/right-reference.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="murphypei">
      <meta itemprop="description" content="è™šæ€€è‹¥è°·ï¼Œå¤§æ™ºè‹¥æ„š">
      <meta itemprop="image" content="/images/avatar_128.ico">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ‹¾è’å¿—">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">C++ å³å€¼å¼•ç”¨ä½¿ç”¨æ€»ç»“

          
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-02-24 19:38:13" itemprop="dateCreated datePublished" datetime="2020-02-24T19:38:13+08:00">2020-02-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-09-06 17:24:43" itemprop="dateModified" datetime="2021-09-06T17:24:43+08:00">2021-09-06</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          
          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              
              <span>13k</span>
            </span>
          
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              
              <span>21 åˆ†é’Ÿ</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ä¸€ç¯‡å…³äº C++11 å³å€¼å¼•ç”¨çš„ä¸€ç¯‡æ€»ç»“ï¼Œè§‰å¾—å…¶ä¸­å¯¹äºå¸¸è§è¯¯ç”¨çš„æ€»ç»“å¾ˆä¸é”™ï¼Œæƒ³èµ·æ¥äº†å½“å¹´è‡ªå·±èµ°è¿‡çš„ä¸€äº›å‘ï¼Œè½¬è½½åšä¸ªè®°å½•ã€‚</p>
<a id="more"></a>
<h3 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h3><blockquote>
<p>å¦‚æœä½ è¿˜ä¸çŸ¥é“ C++ 11 å¼•å…¥çš„å³å€¼å¼•ç”¨æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥è¯»è¯»è¿™ç¯‡æ–‡ç« ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆ <strong>å¯å‘</strong>ï¼›å¦‚æœä½ å·²ç»å¯¹å³å€¼å¼•ç”¨äº†å¦‚æŒ‡æŒï¼Œä¹Ÿå¯ä»¥è¯»è¯»è¿™ç¯‡æ–‡ç« ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆ <strong>è¡¥å……</strong>ã€‚æ¬¢è¿äº¤æµ~ </p>
</blockquote>
<p>å°½ç®¡ C++ 17 æ ‡å‡†å·²ç»å‘å¸ƒäº†ï¼Œå¾ˆå¤šäººè¿˜ä¸ç†Ÿæ‚‰ C++ 11 çš„ <strong>å³å€¼å¼•ç”¨/ç§»åŠ¨è¯­ä¹‰/æ‹·è´çœç•¥/é€šç”¨å¼•ç”¨/å®Œç¾è½¬å‘</strong> ç­‰æ¦‚å¿µï¼Œç”šè‡³å¯¹ä¸€äº›ç»†èŠ‚ <strong>æœ‰æ‰€è¯¯è§£</strong>ï¼ˆåŒ…æ‹¬æˆ‘ï¼‰ã€‚</p>
<p>æœ¬æ–‡å°†ä»¥æœ€çŸ­çš„ç¯‡å¹…ï¼Œä¸€æ­¥æ­¥è§£é‡Š å…³äºå³å€¼å¼•ç”¨çš„ <strong>ä¸ºä»€ä¹ˆ/æ˜¯ä»€ä¹ˆ/æ€ä¹ˆåš</strong>ã€‚å…ˆåˆ†äº«å‡ ä¸ªæˆ‘æ›¾ç»çŠ¯è¿‡çš„é”™è¯¯ã€‚</p>
<h4 id="è¯¯è§£1ï¼šè¿”å›å‰ï¼Œç§»åŠ¨å±€éƒ¨å˜é‡"><a href="#è¯¯è§£1ï¼šè¿”å›å‰ï¼Œç§»åŠ¨å±€éƒ¨å˜é‡" class="headerlink" title="è¯¯è§£1ï¼šè¿”å›å‰ï¼Œç§»åŠ¨å±€éƒ¨å˜é‡"></a>è¯¯è§£1ï¼šè¿”å›å‰ï¼Œç§»åŠ¨å±€éƒ¨å˜é‡</h4><blockquote>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-move" target="_blank" rel="noopener">ES.56: Write <code>std::move()</code> only when you need to explicitly move an object to another scope</a></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> base_url = tag-&gt;GetBaseUrl();</span><br><span class="line"><span class="keyword">if</span> (!base_url.empty()) &#123;</span><br><span class="line">  UpdateQueryUrl(<span class="built_in">std</span>::move(base_url) + <span class="string">"&amp;q="</span> + word_);</span><br><span class="line">&#125;</span><br><span class="line">LOG(INFO) &lt;&lt; base_url;  <span class="comment">// |base_url| may be moved-from</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç çš„é—®é¢˜åœ¨äºï¼šä½¿ç”¨ <code>std::move()</code> ç§»åŠ¨å±€éƒ¨å˜é‡ <code>base_url</code>ï¼Œä¼šå¯¼è‡´åç»­ä»£ç ä¸èƒ½ä½¿ç”¨è¯¥å˜é‡ï¼›å¦‚æœä½¿ç”¨ï¼Œä¼šå‡ºç° <strong>æœªå®šä¹‰è¡Œä¸º</strong> <em>(undefined behavior)</em>ï¼ˆå‚è€ƒï¼š<a href="https://en.cppreference.com/w/cpp/string/basic_string/basic_string" target="_blank" rel="noopener"><code>std::basic_string(basic_string&amp;&amp;)</code></a>ï¼‰ã€‚</p>
<p>å¦‚ä½•æ£€æŸ¥ <strong>ç§»åŠ¨åä½¿ç”¨</strong> <em>(use after move)</em>ï¼š</p>
<ul>
<li>è¿è¡Œæ—¶ï¼Œåœ¨ ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ å‡½æ•°ä¸­ï¼Œå°†è¢«ç§»åŠ¨çš„å€¼è®¾ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå¹¶åœ¨æ¯æ¬¡ä½¿ç”¨å‰æ£€æŸ¥æœ‰æ•ˆæ€§</li>
<li>ç¼–è¯‘æ—¶ï¼Œä½¿ç”¨ Clang æ ‡è®°å¯¹ç§»åŠ¨è¯­ä¹‰è¿›è¡Œé™æ€æ£€æŸ¥ï¼ˆå‚è€ƒï¼š<a href="https://clang.llvm.org/docs/AttributeReference.html#consumed-annotation-checking" target="_blank" rel="noopener">Consumed Annotation Checking | Attributes in Clang</a>ï¼‰</li>
</ul>
<h4 id="è¯¯è§£2ï¼šè¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨"><a href="#è¯¯è§£2ï¼šè¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨" class="headerlink" title="è¯¯è§£2ï¼šè¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨"></a>è¯¯è§£2ï¼šè¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨</h4><blockquote>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-move-semantic" target="_blank" rel="noopener">C.64: A move operation should move and leave its source in a valid state</a></p>
</blockquote>
<p>å¾ˆå¤šäººè®¤ä¸ºï¼šè¢«ç§»åŠ¨çš„å€¼ä¼šè¿›å…¥ä¸€ä¸ª <strong>éæ³•çŠ¶æ€</strong> <em>(invalid state)</em>ï¼Œå¯¹åº”çš„ <strong>å†…å­˜ä¸èƒ½å†è®¿é—®</strong>ã€‚</p>
<p>å…¶å®ï¼ŒC++ æ ‡å‡†è¦æ±‚å¯¹è±¡ éµå®ˆ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è¯­ä¹‰" target="_blank" rel="noopener">Â§ 3</a> <strong>ç§»åŠ¨è¯­ä¹‰</strong> â€”â€” è¢«ç§»åŠ¨çš„å¯¹è±¡è¿›å…¥ä¸€ä¸ª <strong>åˆæ³•ä½†æœªæŒ‡å®šçŠ¶æ€</strong> <em>(valid but unspecified state)</em>ï¼Œè°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬ææ„å‡½æ•°ï¼‰ä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œç”šè‡³åœ¨é‡æ–°èµ‹å€¼åå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> p = <span class="built_in">std</span>::make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">auto</span> q = <span class="built_in">std</span>::move(p);</span><br><span class="line"></span><br><span class="line">assert(p == <span class="literal">nullptr</span>);  <span class="comment">// OK: reset to default</span></span><br><span class="line">p.reset(<span class="keyword">new</span> <span class="keyword">int</span>&#123;<span class="number">2</span>&#125;);   <span class="comment">// or p = std::make_unique&lt;int&gt;(2);</span></span><br><span class="line">assert(*p == <span class="number">2</span>);       <span class="comment">// OK: reset to int*(2)</span></span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼ŒåŸºæœ¬ç±»å‹ï¼ˆä¾‹å¦‚ <code>int/double</code>ï¼‰çš„ç§»åŠ¨è¯­ä¹‰ å’Œæ‹·è´ç›¸åŒï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> j = <span class="built_in">std</span>::move(i);</span><br><span class="line"></span><br><span class="line">assert(i == j);</span><br></pre></td></tr></table></figure>
<h4 id="è¯¯è§£3ï¼šç§»åŠ¨éå¼•ç”¨è¿”å›å€¼"><a href="#è¯¯è§£3ï¼šç§»åŠ¨éå¼•ç”¨è¿”å›å€¼" class="headerlink" title="è¯¯è§£3ï¼šç§»åŠ¨éå¼•ç”¨è¿”å›å€¼"></a>è¯¯è§£3ï¼šç§»åŠ¨éå¼•ç”¨è¿”å›å€¼</h4><blockquote>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-return-move-local" target="_blank" rel="noopener">F.48: Donâ€™t <code>return std::move(local)</code></a></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; foo() &#123;</span><br><span class="line">  <span class="keyword">auto</span> ret = <span class="built_in">std</span>::make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::move(ret);  <span class="comment">// -&gt; return ret;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç çš„é—®é¢˜åœ¨äºï¼šæ²¡å¿…è¦ä½¿ç”¨ <code>std::move()</code> ç§»åŠ¨éå¼•ç”¨è¿”å›å€¼ã€‚</p>
<p>C++ ä¼šæŠŠå³å°†ç¦»å¼€ä½œç”¨åŸŸçš„ <strong>éå¼•ç”¨ç±»å‹çš„</strong> è¿”å›å€¼å½“æˆ <strong>å³å€¼</strong>ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å€¼ç±»åˆ«-vs-å˜é‡ç±»å‹" target="_blank" rel="noopener">Â§ 2.1</a>ï¼‰ï¼Œå¯¹è¿”å›çš„å¯¹è±¡è¿›è¡Œ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è¯­ä¹‰" target="_blank" rel="noopener">Â§ 3</a> ç§»åŠ¨æ„é€ ï¼ˆè¯­è¨€æ ‡å‡†ï¼‰ï¼›å¦‚æœç¼–è¯‘å™¨å…è®¸ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#æ‹·è´çœç•¥" target="_blank" rel="noopener">Â§ 4</a> æ‹·è´çœç•¥ï¼Œè¿˜å¯ä»¥çœç•¥è¿™ä¸€æ­¥çš„æ„é€ ï¼Œç›´æ¥æŠŠ <code>ret</code> å­˜æ”¾åˆ°è¿”å›å€¼çš„å†…å­˜é‡Œï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰ã€‚</p>
<blockquote>
<p>Never apply <code>std::move()</code> or <code>std::forward()</code> to local objects if they would otherwise be eligible for the return value optimization. â€”â€” Scott Meyers, <em>Effective Modern C++</em></p>
</blockquote>
<p>å¦å¤–ï¼Œè¯¯ç”¨ <code>std::move()</code> ä¼š <strong>é˜»æ­¢</strong> ç¼–è¯‘å™¨çš„æ‹·è´çœç•¥ <strong>ä¼˜åŒ–</strong>ã€‚ä¸è¿‡èªæ˜çš„ Clang ä¼šæç¤º <a href="https://developers.redhat.com/blog/2019/04/12/understanding-when-not-to-stdmove-in-c/" target="_blank" rel="noopener"><code>-Wpessimizing-move</code>/<code>-Wredundant-move</code></a> è­¦å‘Šã€‚</p>
<h4 id="è¯¯è§£4ï¼šä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°"><a href="#è¯¯è§£4ï¼šä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°" class="headerlink" title="è¯¯è§£4ï¼šä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°"></a>è¯¯è§£4ï¼šä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°</h4><blockquote>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-consume" target="_blank" rel="noopener">F.18: For â€œwill-move-fromâ€ parameters, pass by <code>X&amp;&amp;</code> and <code>std::move()</code> the parameter</a></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt; bar(<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="keyword">int</span>&gt;&amp;&amp; val) &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">return</span> val;    <span class="comment">// not compile</span></span><br><span class="line">                 <span class="comment">// -&gt; return std::move/forward(val);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç çš„é—®é¢˜åœ¨äºï¼šæ²¡æœ‰å¯¹è¿”å›å€¼ä½¿ç”¨ <code>std::move()</code>ï¼ˆç¼–è¯‘å™¨æç¤º <code>std::unique_ptr(const std::unique_ptr&amp;) = delete</code> é”™è¯¯ï¼‰ã€‚</p>
<blockquote>
<p><a href="http://thbecker.net/articles/rvalue_references/section_05.html#no_name" target="_blank" rel="noopener">If-it-has-a-name Rule</a>:</p>
<ul>
<li>Named rvalue references are lvalues.</li>
<li>Unnamed rvalue references are rvalues.</li>
</ul>
</blockquote>
<p>å› ä¸ºä¸è®º <strong>å·¦å€¼å¼•ç”¨</strong> è¿˜æ˜¯ <strong>å³å€¼å¼•ç”¨</strong> çš„å˜é‡ï¼ˆæˆ–å‚æ•°ï¼‰åœ¨åˆå§‹åŒ–åï¼Œéƒ½æ˜¯å·¦å€¼ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å€¼ç±»åˆ«-vs-å˜é‡ç±»å‹" target="_blank" rel="noopener">Â§ 2.1</a>ï¼‰ï¼š</p>
<ul>
<li><strong>å‘½åçš„å³å€¼å¼•ç”¨</strong> <em>(named rvalue reference)</em> <strong>å˜é‡</strong> æ˜¯ <strong>å·¦å€¼</strong>ï¼Œä½†å˜é‡ç±»å‹å´æ˜¯ <strong>å³å€¼å¼•ç”¨</strong>ã€‚</li>
<li>åœ¨ä½œç”¨åŸŸå†…ï¼Œ<strong>å·¦å€¼å˜é‡</strong> å¯ä»¥é€šè¿‡ <strong>å˜é‡å</strong> <em>(variable name)</em> <strong>è¢«å–åœ°å€ã€è¢«èµ‹å€¼</strong>ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œè¿”å›å³å€¼å¼•ç”¨å˜é‡æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>std::move()</code>/<code>std::forward()</code> æ˜¾å¼çš„ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è½¬å‘" target="_blank" rel="noopener">Â§ 5.4</a> <strong>ç§»åŠ¨è½¬å‘</strong> æˆ– <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å®Œç¾è½¬å‘" target="_blank" rel="noopener">Â§ 5.3</a> <strong>å®Œç¾è½¬å‘</strong>ï¼Œå°†å˜é‡ â€œè¿˜åŸâ€ ä¸ºå³å€¼ï¼ˆå³å€¼å¼•ç”¨ç±»å‹ï¼‰ã€‚</p>
<blockquote>
<p>è¿™é‡Œè¡¥å……ä¸€ä¸‹ï¼Œè¿™é‡Œè¯´çš„æ˜¯å³å€¼å¼•ç”¨çš„å˜é‡ï¼Œå¸¸è§äºå‡½æ•°çš„å‚æ•°ï¼Œå‡½æ•°å‚æ•°ä¼ é€’ä¼šå¯¼è‡´å¤–é¢çš„å³å€¼å¼•ç”¨è¿›å…¥å‡½æ•°å†…éƒ¨ä½œä¸ºå‚æ•°å˜æˆäº†å·¦å€¼å˜é‡ã€‚</p>
</blockquote>
<h4 id="è¯¯è§£5ï¼šæ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°"><a href="#è¯¯è§£5ï¼šæ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°" class="headerlink" title="è¯¯è§£5ï¼šæ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°"></a>è¯¯è§£5ï¼šæ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°</h4><blockquote>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-zero" target="_blank" rel="noopener">C.20: If you can avoid defining default operations, do</a></p>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-five" target="_blank" rel="noopener">C.21: If you define or <code>=delete</code> any default operation, define or <code>=delete</code> them all</a></p>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eqdefault" target="_blank" rel="noopener">C.80: Use <code>=default</code> if you have to be explicit about using the default semantics</a></p>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-move-noexcept" target="_blank" rel="noopener">C.66: Make move operations <code>noexcept</code></a></p>
</blockquote>
<p>å®é™…ä¸Šï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>å¦‚æœ <strong>æ²¡æœ‰å®šä¹‰</strong> æ‹·è´æ„é€ /æ‹·è´èµ‹å€¼/ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼/ææ„ å‡½æ•°çš„ä»»ä½•ä¸€ä¸ªï¼Œç¼–è¯‘å™¨ä¼š <strong>è‡ªåŠ¨ç”Ÿæˆ</strong> ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ å‡½æ•°ï¼ˆ<a href="https://en.cppreference.com/w/cpp/language/rule_of_three#Rule_of_zero" target="_blank" rel="noopener">rule of zero</a>ï¼‰</li>
<li>å¦‚æœ <strong>éœ€è¦å®šä¹‰</strong> æ‹·è´æ„é€ /æ‹·è´èµ‹å€¼/ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼/ææ„ å‡½æ•°çš„ä»»ä½•ä¸€ä¸ªï¼Œä¸è¦å¿˜äº† ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ å‡½æ•°ï¼Œå¦åˆ™å¯¹è±¡ä¼š <strong>ä¸å¯ç§»åŠ¨</strong>ï¼ˆ<a href="https://en.cppreference.com/w/cpp/language/rule_of_three#Rule_of_five" target="_blank" rel="noopener">rule of five</a>ï¼‰</li>
<li><strong>å°½é‡ä½¿ç”¨</strong> <code>=default</code> è®©ç¼–è¯‘å™¨ç”Ÿæˆ ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ å‡½æ•°ï¼Œå¦åˆ™ <strong>å®¹æ˜“å†™é”™</strong></li>
<li>å¦‚æœ <strong>éœ€è¦è‡ªå®šä¹‰</strong> ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ å‡½æ•°ï¼Œå°½é‡å®šä¹‰ä¸º <code>noexcept</code> ä¸æŠ›å‡ºå¼‚å¸¸ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„ç‰ˆæœ¬ä¼šè‡ªåŠ¨æ·»åŠ ï¼‰ï¼Œå¦åˆ™ <strong>ä¸èƒ½é«˜æ•ˆ</strong> ä½¿ç”¨æ ‡å‡†åº“å’Œè¯­è¨€å·¥å…·</li>
</ul>
<p>ä¾‹å¦‚ï¼Œæ ‡å‡†åº“å®¹å™¨ <code>std::vector</code> åœ¨æ‰©å®¹æ—¶ï¼Œä¼šé€šè¿‡ <a href="https://en.cppreference.com/w/cpp/container/vector/reserve#Exceptions" target="_blank" rel="noopener"><code>std::vector::reserve()</code></a> é‡æ–°åˆ†é…ç©ºé—´ï¼Œå¹¶è½¬ç§»å·²æœ‰å…ƒç´ ã€‚å¦‚æœæ‰©å®¹å¤±è´¥ï¼Œ<code>std::vector</code> æ»¡è¶³ <a href="https://en.cppreference.com/w/cpp/language/exceptions#Exception_safety" target="_blank" rel="noopener"><strong>å¼ºå¼‚å¸¸ä¿è¯</strong> <em>(strong exception guarantee)</em></a>ï¼Œå¯ä»¥å›æ»šåˆ°å¤±è´¥å‰çš„çŠ¶æ€ã€‚</p>
<p>ä¸ºæ­¤ï¼Œ<code>std::vector</code> ä½¿ç”¨ <a href="https://en.cppreference.com/w/cpp/utility/move_if_noexcept" target="_blank" rel="noopener"><code>std::move_if_noexcept()</code></a> è¿›è¡Œå…ƒç´ çš„è½¬ç§»æ“ä½œï¼š</p>
<ul>
<li>ä¼˜å…ˆ ä½¿ç”¨ <code>noexcept</code> ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆé«˜æ•ˆï¼›ä¸æŠ›å‡ºå¼‚å¸¸ï¼‰</li>
<li>å…¶æ¬¡ ä½¿ç”¨ æ‹·è´æ„é€ å‡½æ•°ï¼ˆä½æ•ˆï¼›å¦‚æœå¼‚å¸¸ï¼Œå¯ä»¥å›æ»šï¼‰</li>
<li>å†æ¬¡ ä½¿ç”¨ é <code>noexcept</code> ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆé«˜æ•ˆï¼›å¦‚æœå¼‚å¸¸ï¼Œ<strong>æ— æ³•å›æ»š</strong>ï¼‰</li>
<li>æœ€å å¦‚æœ ä¸å¯æ‹·è´ã€ä¸å¯ç§»åŠ¨ï¼Œ<strong>ç¼–è¯‘å¤±è´¥</strong></li>
</ul>
<p>å¦‚æœ æ²¡æœ‰å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°æˆ–è‡ªå®šä¹‰çš„ç§»åŠ¨æ„é€ å‡½æ•°æ²¡æœ‰ <code>noexcept</code>ï¼Œä¼šå¯¼è‡´ <code>std::vector</code> æ‰©å®¹æ—¶æ‰§è¡Œæ— ç”¨çš„æ‹·è´ï¼Œ<strong>ä¸æ˜“å‘ç°</strong>ã€‚</p>
<h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><p>ä¹‹æ‰€ä»¥ä¼šå‡ºç°ä¸Šè¾¹çš„è¯¯è§£ï¼Œå¾€å¾€æ˜¯å› ä¸º C++ è¯­è¨€çš„å¤æ‚æ€§å’Œä½¿ç”¨è€…å¯¹åŸºç¡€çŸ¥è¯†çš„æŒæ¡ç¨‹åº¦ä¸åŒ¹é…ã€‚</p>
<h4 id="å€¼ç±»åˆ«-vs-å˜é‡ç±»å‹"><a href="#å€¼ç±»åˆ«-vs-å˜é‡ç±»å‹" class="headerlink" title="å€¼ç±»åˆ« vs å˜é‡ç±»å‹"></a>å€¼ç±»åˆ« vs å˜é‡ç±»å‹</h4><p><strong>åˆ’é‡ç‚¹</strong> â€”â€” <strong>å€¼</strong> <em>(value)</em> å’Œ <strong>å˜é‡</strong> <em>(variable)</em> æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µï¼š</p>
<ul>
<li>å€¼åªæœ‰ <strong>ç±»åˆ«</strong> <em>(category)</em> çš„åˆ’åˆ†ï¼Œå˜é‡ åªæœ‰ <strong>ç±»å‹</strong> <em>(type)</em> çš„åˆ’åˆ† ğŸ˜µ</li>
<li>å€¼ä¸ä¸€å®šæ‹¥æœ‰ <strong>èº«ä»½</strong> <em>(identity)</em>ï¼Œä¹Ÿä¸ä¸€å®šæ‹¥æœ‰ å˜é‡åï¼ˆä¾‹å¦‚ è¡¨è¾¾å¼ä¸­é—´ç»“æœ <code>i + j + k</code>ï¼‰</li>
</ul>
<p><a href="https://en.cppreference.com/w/cpp/language/value_category" target="_blank" rel="noopener"><strong>å€¼ç±»åˆ«</strong> <em>(value category)</em></a> å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><strong>å·¦å€¼</strong> <em>(lvalue, left value)</em> æ˜¯èƒ½è¢«å–åœ°å€ã€ä¸èƒ½è¢«ç§»åŠ¨çš„å€¼</li>
<li><strong>å³å€¼</strong> <em>(rvalue, right value)</em> æ˜¯è¡¨è¾¾å¼ä¸­é—´ç»“æœ/å‡½æ•°è¿”å›å€¼ï¼ˆå¯èƒ½æ‹¥æœ‰å˜é‡åï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼‰</li>
</ul>
<blockquote>
<p>C++ 17 ç»†åŒ–äº† <code>prvalue/xvalue/lvalue</code> å’Œ <code>rvalue/glvalue</code> ç±»åˆ«ï¼Œæœ¬æ–‡ä¸è¯¦ç»†è®¨è®ºã€‚</p>
</blockquote>
<p><a href="https://en.cppreference.com/w/cpp/language/reference" target="_blank" rel="noopener"><strong>å¼•ç”¨ç±»å‹</strong> <em>(reference type)</em></a> å±äºä¸€ç§ <a href="https://en.cppreference.com/w/cpp/language/type" target="_blank" rel="noopener"><strong>å˜é‡ç±»å‹</strong> <em>(variable type)</em></a>ï¼Œå°†åœ¨ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å·¦å€¼å¼•ç”¨-vs-å³å€¼å¼•ç”¨-vs-å¸¸å¼•ç”¨" target="_blank" rel="noopener">Â§ 2.2</a> è¯¦ç»†è®¨è®ºã€‚</p>
<p>åœ¨å˜é‡ <a href="https://en.cppreference.com/w/cpp/language/initialization" target="_blank" rel="noopener"><strong>åˆå§‹åŒ–</strong> <em>(initialization)</em></a> æ—¶ï¼Œéœ€è¦å°† <strong>åˆå§‹å€¼</strong> <em>(initial value)</em> ç»‘å®šåˆ°å˜é‡ä¸Šï¼›ä½† <a href="https://en.cppreference.com/w/cpp/language/reference_initialization" target="_blank" rel="noopener"><strong>å¼•ç”¨ç±»å‹å˜é‡</strong> çš„åˆå§‹åŒ–</a> å’Œå…¶ä»–çš„å€¼ç±»å‹ï¼ˆéå¼•ç”¨ç±»å‹ï¼‰å˜é‡ä¸åŒï¼š</p>
<ul>
<li>åˆ›å»ºæ—¶ï¼Œ<strong>å¿…é¡»æ˜¾å¼åˆå§‹åŒ–</strong>ï¼ˆå’ŒæŒ‡é’ˆä¸åŒï¼Œä¸å…è®¸ <strong>ç©ºå¼•ç”¨</strong> <em>(null reference)</em>ï¼›ä½†å¯èƒ½å­˜åœ¨ <strong>æ‚¬å‚å¼•ç”¨</strong> <em>(dangling reference)</em>ï¼‰</li>
<li>ç›¸å½“äºæ˜¯ å…¶å¼•ç”¨çš„å€¼ çš„ä¸€ä¸ª <strong>åˆ«å</strong> <em>(alias)</em>ï¼ˆä¾‹å¦‚ï¼Œå¯¹å¼•ç”¨å˜é‡çš„ <strong>èµ‹å€¼è¿ç®—</strong> <em>(assignment operation)</em> ä¼šèµ‹å€¼åˆ° å…¶å¼•ç”¨çš„å€¼ ä¸Šï¼‰</li>
<li>ä¸€æ—¦ç»‘å®šäº†åˆå§‹å€¼ï¼Œå°± <strong>ä¸èƒ½é‡æ–°ç»‘å®š</strong> åˆ°å…¶ä»–å€¼ä¸Šäº†ï¼ˆå’ŒæŒ‡é’ˆä¸åŒï¼Œèµ‹å€¼è¿ç®—ä¸èƒ½ä¿®æ”¹å¼•ç”¨çš„æŒ‡å‘ï¼›è€Œå¯¹äº Java/JavaScript ç­‰è¯­è¨€ï¼Œå¯¹å¼•ç”¨å˜é‡èµ‹å€¼ å¯ä»¥é‡æ–°ç»‘å®šï¼‰</li>
</ul>
<h4 id="å·¦å€¼å¼•ç”¨-vs-å³å€¼å¼•ç”¨-vs-å¸¸å¼•ç”¨"><a href="#å·¦å€¼å¼•ç”¨-vs-å³å€¼å¼•ç”¨-vs-å¸¸å¼•ç”¨" class="headerlink" title="å·¦å€¼å¼•ç”¨ vs å³å€¼å¼•ç”¨ vs å¸¸å¼•ç”¨"></a>å·¦å€¼å¼•ç”¨ vs å³å€¼å¼•ç”¨ vs å¸¸å¼•ç”¨</h4><p>å¼•ç”¨ç±»å‹ å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><strong>å·¦å€¼å¼•ç”¨</strong> <em>(l-ref, lvalue reference)</em> ç”¨ <code>&amp;</code> ç¬¦å·å¼•ç”¨ å·¦å€¼ï¼ˆä½†ä¸èƒ½å¼•ç”¨å³å€¼ï¼‰</li>
<li><strong>å³å€¼å¼•ç”¨</strong> <em>(r-ref, rvalue reference)</em> ç”¨ <code>&amp;&amp;</code> ç¬¦å·å¼•ç”¨ å³å€¼ï¼ˆä¹Ÿå¯ä»¥ç§»åŠ¨å·¦å€¼ï¼‰</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(Data&amp;  data)</span></span>;  <span class="comment">// 1, data is l-ref</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(Data&amp;&amp; data)</span></span>;  <span class="comment">// 2, data is r-ref</span></span><br><span class="line">Data   data;</span><br><span class="line"></span><br><span class="line">Data&amp;  data1 = data;             <span class="comment">// OK</span></span><br><span class="line">Data&amp;  data1 = Data&#123;&#125;;           <span class="comment">// not compile: invalid binding</span></span><br><span class="line">Data&amp;&amp; data2 = Data&#123;&#125;;           <span class="comment">// OK</span></span><br><span class="line">Data&amp;&amp; data2 = data;             <span class="comment">// not compile: invalid binding</span></span><br><span class="line">Data&amp;&amp; data2 = <span class="built_in">std</span>::move(data);  <span class="comment">// OK</span></span><br><span class="line"></span><br><span class="line">f(data);    <span class="comment">// 1, data is lvalue</span></span><br><span class="line">f(Data&#123;&#125;);  <span class="comment">// 2, data is rvalue</span></span><br><span class="line">f(data1);   <span class="comment">// 1, data1 is l-ref type and lvalue</span></span><br><span class="line">f(data2);   <span class="comment">// 1, data2 is r-ref type but lvalue</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å·¦å€¼å¼•ç”¨å˜é‡ <code>data1</code> åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¸èƒ½ç»‘å®šå³å€¼ <code>Data{}</code></li>
<li>å³å€¼å¼•ç”¨å˜é‡ <code>data2</code> åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¸èƒ½ç»‘å®šå·¦å€¼ <code>data</code>ï¼Œä½†å¯ä»¥é€šè¿‡ <code>std::move()</code> å°†å·¦å€¼ <strong>è½¬ä¸ºå³å€¼å¼•ç”¨</strong>ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è½¬å‘" target="_blank" rel="noopener">Â§ 5.4</a>ï¼‰</li>
<li><strong>å³å€¼å¼•ç”¨</strong> å˜é‡ <code>data2</code> è¢«åˆå§‹åŒ–åï¼Œåœ¨ä½œç”¨åŸŸå†…æ˜¯ <strong>å·¦å€¼</strong>ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#è¯¯è§£-ä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°" target="_blank" rel="noopener">Â§ 1.4</a>ï¼‰ï¼Œæ‰€ä»¥åŒ¹é… <code>f()</code> çš„ <strong>é‡è½½ 2</strong></li>
</ul>
<p>å¦å¤–ï¼ŒC++ è¿˜æ”¯æŒäº† <strong>å¸¸å¼•ç”¨</strong> <em>(c-ref, const reference)</em>ï¼Œ<strong>åŒæ—¶æ¥å—</strong> å·¦å€¼/å³å€¼ è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(<span class="keyword">const</span> Data&amp; data)</span></span>;  <span class="comment">// data is c-ref</span></span><br><span class="line"></span><br><span class="line">g(data);    <span class="comment">// ok, data is lvalue</span></span><br><span class="line">g(Data&#123;&#125;);  <span class="comment">// ok, data is rvalue</span></span><br></pre></td></tr></table></figure>
<p>å¸¸å¼•ç”¨å’Œå³å€¼å¼•ç”¨ éƒ½èƒ½æ¥å—å³å€¼çš„ç»‘å®šï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<ul>
<li>é€šè¿‡ å³å€¼å¼•ç”¨/å¸¸å¼•ç”¨ åˆå§‹åŒ–çš„å³å€¼ï¼Œéƒ½å¯ä»¥å°† <a href="https://en.cppreference.com/w/cpp/language/reference_initialization#Lifetime_of_a_temporary" target="_blank" rel="noopener"><strong>ç”Ÿå‘½å‘¨æœŸæ‰©å±•</strong> <em>(lifetime extension)</em></a> åˆ° ç»‘å®šè¯¥å³å€¼çš„ å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>åˆå§‹åŒ–æ—¶ ç»‘å®šäº†å³å€¼åï¼Œå³å€¼å¼•ç”¨ <strong>å¯ä»¥ä¿®æ”¹</strong> å¼•ç”¨çš„å³å€¼ï¼Œè€Œ å¸¸å¼•ç”¨ ä¸èƒ½ä¿®æ”¹</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Data&amp; data1 = Data&#123;&#125;;   <span class="comment">// OK: extend lifetime</span></span><br><span class="line">data1.modify();               <span class="comment">// not compile: const</span></span><br><span class="line"></span><br><span class="line">Data&amp;&amp; data2 = Data&#123;&#125;;        <span class="comment">// OK: extend lifetime</span></span><br><span class="line">data2.modify();               <span class="comment">// OK: non-const</span></span><br></pre></td></tr></table></figure>
<h4 id="å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§"><a href="#å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§" class="headerlink" title="å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§"></a>å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§</h4><p>å¦‚æœå‡½æ•°é‡è½½åŒæ—¶æ¥å— å³å€¼å¼•ç”¨/å¸¸å¼•ç”¨ å‚æ•°ï¼Œç¼–è¯‘å™¨ <strong>ä¼˜å…ˆé‡è½½</strong> å³å€¼å¼•ç”¨å‚æ•° â€”â€” æ˜¯ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è¯­ä¹‰" target="_blank" rel="noopener">Â§ 3</a> ç§»åŠ¨è¯­ä¹‰ çš„å®ç°åŸºç¡€ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> Data&amp; data)</span></span>;  <span class="comment">// 1, data is c-ref</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(Data&amp;&amp; data)</span></span>;       <span class="comment">// 2, data is r-ref</span></span><br><span class="line"></span><br><span class="line">f(Data&#123;&#125;);  <span class="comment">// 2, prefer 2 over 1 for rvalue</span></span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹ä¸åŒå·¦å³å€¼ <strong>å®å‚</strong> <em>(argument)</em> é‡è½½ å¼•ç”¨ç±»å‹ <strong>å½¢å‚</strong> <em>(parameter)</em> çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">å®å‚/å½¢å‚</th>
<th style="text-align:center">T&amp;</th>
<th style="text-align:center">const T&amp;</th>
<th style="text-align:center">T&amp;&amp;</th>
<th style="text-align:center">const T&amp;&amp;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">lvalue</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">const lvalue</td>
<td style="text-align:center"></td>
<td style="text-align:center">1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">rvalue</td>
<td style="text-align:center"></td>
<td style="text-align:center">3</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">const rvalue</td>
<td style="text-align:center"></td>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™é‡è½½å¤±è´¥</li>
<li>å¦‚æœåŒæ—¶å­˜åœ¨ <strong>ä¼ å€¼</strong> <em>(by value)</em> é‡è½½ï¼ˆæ¥å—å€¼ç±»å‹å‚æ•° <code>T</code>ï¼‰ï¼Œä¼šå’Œä¸Šè¿° <strong>ä¼ å¼•ç”¨</strong> <em>(by reference)</em> é‡è½½äº§ç”Ÿæ­§ä¹‰ï¼Œç¼–è¯‘å¤±è´¥</li>
<li><strong>å¸¸å³å€¼å¼•ç”¨</strong> <em>(const rvalue reference)</em> <code>const T&amp;&amp;</code> ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ï¼ˆ<a href="https://codesynthesis.com/~boris/blog/2012/07/24/const-rvalue-references/" target="_blank" rel="noopener">å‚è€ƒ</a>ï¼‰</li>
</ul>
<h4 id="å¼•ç”¨æŠ˜å "><a href="#å¼•ç”¨æŠ˜å " class="headerlink" title="å¼•ç”¨æŠ˜å "></a>å¼•ç”¨æŠ˜å </h4><p><a href="https://en.cppreference.com/w/cpp/language/reference#Reference_collapsing" target="_blank" rel="noopener"><strong>å¼•ç”¨æŠ˜å </strong> <em>(reference collapsing)</em></a> æ˜¯ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è½¬å‘" target="_blank" rel="noopener">Â§ 5.4</a> <code>std::move()</code> å’Œ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å®Œç¾è½¬å‘" target="_blank" rel="noopener">Â§ 5.3</a> <code>std::forward()</code> çš„å®ç°åŸºç¡€ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Lref = Data&amp;;</span><br><span class="line"><span class="keyword">using</span> Rref = Data&amp;&amp;;</span><br><span class="line">Data data;</span><br><span class="line"></span><br><span class="line">Lref&amp;  r1 = data;    <span class="comment">// r1 is Data&amp;</span></span><br><span class="line">Lref&amp;&amp; r2 = data;    <span class="comment">// r2 is Data&amp;</span></span><br><span class="line">Rref&amp;  r3 = data;    <span class="comment">// r3 is Data&amp;</span></span><br><span class="line">Rref&amp;&amp; r4 = Data&#123;&#125;;  <span class="comment">// r4 is Data&amp;&amp;</span></span><br></pre></td></tr></table></figure>
<h3 id="ç§»åŠ¨è¯­ä¹‰"><a href="#ç§»åŠ¨è¯­ä¹‰" class="headerlink" title="ç§»åŠ¨è¯­ä¹‰"></a>ç§»åŠ¨è¯­ä¹‰</h3><p>åœ¨ C++ 11 å¼ºåŒ–äº†å·¦å³å€¼æ¦‚å¿µåï¼Œæå‡ºäº† <strong>ç§»åŠ¨è¯­ä¹‰</strong> <em>(move semantic)</em> ä¼˜åŒ–ï¼šç”±äºå³å€¼å¯¹è±¡ä¸€èˆ¬æ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œåœ¨ç§»åŠ¨æ—¶ï¼Œå¯¹è±¡åŒ…å«çš„èµ„æº <strong>ä¸éœ€è¦å…ˆæ‹·è´å†åˆ é™¤</strong>ï¼Œåªéœ€è¦ç›´æ¥ <strong>ä»æ—§å¯¹è±¡ç§»åŠ¨åˆ°æ–°å¯¹è±¡</strong>ã€‚</p>
<p>åŒæ—¶ï¼Œè¦æ±‚ <strong>è¢«ç§»åŠ¨çš„å¯¹è±¡</strong> å¤„äº <strong>åˆæ³•ä½†æœªæŒ‡å®šçŠ¶æ€</strong>ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#è¯¯è§£-è¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨" target="_blank" rel="noopener">Â§ 1.2</a>ï¼‰ï¼š</p>
<ul>
<li>ï¼ˆåŸºæœ¬è¦æ±‚ï¼‰èƒ½æ­£ç¡®ææ„ï¼ˆä¸ä¼šé‡å¤é‡Šæ”¾å·²ç»è¢«ç§»åŠ¨äº†çš„èµ„æºï¼Œä¾‹å¦‚ <code>std::unique_ptr::~unique_ptr()</code> æ£€æŸ¥æŒ‡é’ˆæ˜¯å¦éœ€è¦ <code>delete</code>ï¼‰</li>
<li>ï¼ˆä¸€èˆ¬è¦æ±‚ï¼‰é‡æ–°èµ‹å€¼åï¼Œå’Œæ–°çš„å¯¹è±¡æ²¡æœ‰å·®åˆ«ï¼ˆC++ æ ‡å‡†åº“åŸºäºè¿™ä¸ªå‡è®¾ï¼‰</li>
<li>ï¼ˆæ›´é«˜è¦æ±‚ï¼‰æ¢å¤ä¸ºé»˜è®¤å€¼ï¼ˆä¾‹å¦‚ <code>std::unique_ptr</code> æ¢å¤ä¸º <code>nullptr</code>ï¼‰</li>
</ul>
<p>ç”±äº<strong>åŸºæœ¬ç±»å‹ä¸åŒ…å«èµ„æºï¼Œå…¶ç§»åŠ¨å’Œæ‹·è´ç›¸åŒï¼šè¢«ç§»åŠ¨åï¼Œä¿æŒä¸ºåŸæœ‰å€¼</strong>ã€‚</p>
<h4 id="é¿å…å…ˆæ‹·è´å†é‡Šæ”¾èµ„æº"><a href="#é¿å…å…ˆæ‹·è´å†é‡Šæ”¾èµ„æº" class="headerlink" title="é¿å…å…ˆæ‹·è´å†é‡Šæ”¾èµ„æº"></a>é¿å…å…ˆæ‹·è´å†é‡Šæ”¾èµ„æº</h4><p>ä¸€èˆ¬é€šè¿‡ <strong>é‡è½½æ„é€ /èµ‹å€¼å‡½æ•°</strong> å®ç°ç§»åŠ¨è¯­ä¹‰ã€‚ä¾‹å¦‚ï¼Œ<code>std::vector</code> æœ‰ï¼š</p>
<ul>
<li>ä»¥å¸¸å¼•ç”¨ä½œä¸ºå‚æ•°çš„ <strong>æ‹·è´æ„é€ å‡½æ•°</strong> <em>(copy constructor)</em></li>
<li>ä»¥å³å€¼å¼•ç”¨ä½œä¸ºå‚æ•°çš„ <strong>ç§»åŠ¨æ„é€ å‡½æ•°</strong> <em>(move constructor)</em></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vector</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">vector</span>(<span class="keyword">const</span> <span class="built_in">vector</span>&amp; rhs);      <span class="comment">// copy data</span></span><br><span class="line">  <span class="built_in">vector</span>(<span class="built_in">vector</span>&amp;&amp; rhs) <span class="keyword">noexcept</span>;  <span class="comment">// move data</span></span><br><span class="line">  ~<span class="built_in">vector</span>();                      <span class="comment">// dtor</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  T* data_ = <span class="literal">nullptr</span>;</span><br><span class="line">  <span class="keyword">size_t</span> size_ = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>::<span class="built_in">vector</span>(<span class="keyword">const</span> <span class="built_in">vector</span>&amp; rhs) : data_(<span class="keyword">new</span> T[rhs.size_]) &#123;</span><br><span class="line">  <span class="keyword">auto</span> &amp;lhs = *<span class="keyword">this</span>;</span><br><span class="line">  lhs.size_ = rhs.size_;</span><br><span class="line">  <span class="built_in">std</span>::copy_n(rhs.data_, rhs.size_, lhs.data_);  <span class="comment">// copy data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>::<span class="built_in">vector</span>(<span class="built_in">vector</span>&amp;&amp; rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">  <span class="keyword">auto</span> &amp;lhs = *<span class="keyword">this</span>;</span><br><span class="line">  lhs.size_ = rhs.size_;</span><br><span class="line">  lhs.data_ = rhs.data_;  <span class="comment">// move data</span></span><br><span class="line">  rhs.size_ = <span class="number">0</span>;</span><br><span class="line">  rhs.data_ = <span class="literal">nullptr</span>;    <span class="comment">// set data of rhs to null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>::~<span class="built_in">vector</span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> (data_)              <span class="comment">// release only if owned</span></span><br><span class="line">    <span class="keyword">delete</span>[] data_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæ„é€ å‡½æ•° <code>vector::vector()</code> æ ¹æ®å®å‚åˆ¤æ–­ï¼ˆé‡è½½ä¼˜å…ˆçº§å‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§" target="_blank" rel="noopener">Â§ 2.3</a>ï¼‰ï¼š</p>
<ul>
<li>å®å‚ä¸ºå·¦å€¼æ—¶ï¼Œæ‹·è´æ„é€ ï¼Œä½¿ç”¨ <code>new[]</code>/<code>std::copy_n</code> æ‹·è´åŸå¯¹è±¡çš„æ‰€æœ‰å…ƒç´ ï¼ˆæœ¬æ–¹æ¡ˆæœ‰ä¸€æ¬¡å†—ä½™çš„é»˜è®¤æ„é€ ï¼Œä»…ç”¨äºæ¼”ç¤ºï¼‰ã€‚</li>
<li>å®å‚ä¸ºå³å€¼æ—¶ï¼Œç§»åŠ¨æ„é€ ï¼ŒæŠŠæŒ‡å‘åŸå¯¹è±¡å†…å­˜çš„æŒ‡é’ˆ <code>data_</code>ã€å†…å­˜å¤§å° <code>size_</code> æ‹·è´åˆ°æ–°å¯¹è±¡ï¼Œå¹¶æŠŠåŸå¯¹è±¡è¿™ä¸¤ä¸ªæˆå‘˜ç½® <code>0</code>ã€‚</li>
</ul>
<p>ææ„å‡½æ•° <code>vector::~vector()</code> æ£€æŸ¥ data_ æ˜¯å¦æœ‰æ•ˆï¼Œå†³å®šæ˜¯å¦éœ€è¦é‡Šæ”¾èµ„æºã€‚</p>
<blockquote>
<p>æ­¤å¤„çœç•¥ æ‹·è´èµ‹å€¼/ç§»åŠ¨èµ‹å€¼ å‡½æ•°ï¼Œä½†å»ºè®®åŠ ä¸Šã€‚ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#è¯¯è§£-æ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°" target="_blank" rel="noopener">Â§ 1.5</a>ï¼‰</p>
</blockquote>
<p>æ­¤å¤–ï¼Œ<strong>ç±»çš„æˆå‘˜å‡½æ•°</strong> è¿˜å¯ä»¥é€šè¿‡ <a href="https://en.cppreference.com/w/cpp/language/member_functions#const-.2C_volatile-.2C_and_ref-qualified_member_functions" target="_blank" rel="noopener"><strong>å¼•ç”¨é™å®šç¬¦</strong> <em>(reference qualifier)</em></a>ï¼Œé’ˆå¯¹å½“å‰å¯¹è±¡æœ¬èº«çš„å·¦å³å€¼çŠ¶æ€ï¼ˆä»¥åŠ const-volatileï¼‰é‡è½½ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function">Data <span class="title">data</span><span class="params">()</span> &amp;&amp; </span>&#123; <span class="keyword">return</span> <span class="built_in">std</span>::move(data_); &#125;  <span class="comment">// rvalue, move-out</span></span><br><span class="line">  <span class="function">Data <span class="title">data</span><span class="params">()</span> <span class="keyword">const</span>&amp; </span>&#123; <span class="keyword">return</span> data_; &#125;         <span class="comment">// otherwise, copy</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ret1 = foo.data();    <span class="comment">// foo   is lvalue, copy</span></span><br><span class="line"><span class="keyword">auto</span> ret2 = Foo&#123;&#125;.data();  <span class="comment">// Foo&#123;&#125; is rvalue, move</span></span><br></pre></td></tr></table></figure>
<h4 id="è½¬ç§»ä¸å¯æ‹·è´çš„èµ„æº"><a href="#è½¬ç§»ä¸å¯æ‹·è´çš„èµ„æº" class="headerlink" title="è½¬ç§»ä¸å¯æ‹·è´çš„èµ„æº"></a>è½¬ç§»ä¸å¯æ‹·è´çš„èµ„æº</h4><blockquote>
<p>åœ¨ä¹‹å‰å†™çš„ <a href="https://bot-man-jl.github.io/articles/?post=2018/Resource-Management#èµ„æºå’Œå¯¹è±¡çš„æ˜ å°„å…³ç³»" target="_blank" rel="noopener">èµ„æºç®¡ç†å°è®°</a> æåˆ°ï¼šå¦‚æœèµ„æºæ˜¯ <strong>ä¸å¯æ‹·è´</strong> <em>(non-copyable)</em> çš„ï¼Œé‚£ä¹ˆè£…è½½èµ„æºçš„å¯¹è±¡ä¹Ÿåº”è¯¥æ˜¯ä¸å¯æ‹·è´çš„ã€‚</p>
</blockquote>
<p>å¦‚æœèµ„æºå¯¹è±¡ä¸å¯æ‹·è´ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰ ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ å‡½æ•°ï¼Œå¹¶ç¦ç”¨ æ‹·è´æ„é€ /æ‹·è´èµ‹å€¼ å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæ™ºèƒ½æŒ‡é’ˆ <code>std::unique_ptr</code> <strong>åªèƒ½ç§»åŠ¨</strong> <em>(move only)</em>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">unique_ptr</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">unique_ptr</span>(<span class="keyword">const</span> <span class="built_in">unique_ptr</span>&amp; rhs) = <span class="keyword">delete</span>;</span><br><span class="line">  <span class="built_in">unique_ptr</span>(<span class="built_in">unique_ptr</span>&amp;&amp; rhs) <span class="keyword">noexcept</span>;  <span class="comment">// move only</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  T* data_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">unique_ptr</span>::<span class="built_in">unique_ptr</span>(<span class="built_in">unique_ptr</span>&amp;&amp; rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">  <span class="keyword">auto</span> &amp;lhs = *<span class="keyword">this</span>;</span><br><span class="line">  lhs.data_ = rhs.data_;</span><br><span class="line">  rhs.data_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>unique_ptr</code> çš„ç§»åŠ¨æ„é€ è¿‡ç¨‹å’Œ <code>vector</code> ç±»ä¼¼ï¼š</p>
<ul>
<li>æŠŠæŒ‡å‘åŸå¯¹è±¡å†…å­˜çš„æŒ‡é’ˆ <code>data_</code> æ‹·è´åˆ°æ–°å¯¹è±¡</li>
<li>æŠŠåŸå¯¹è±¡çš„æŒ‡é’ˆ <code>data_</code> ç½®ä¸ºç©º</li>
</ul>
<h4 id="åä¾‹ï¼šä¸éµå®ˆç§»åŠ¨è¯­ä¹‰"><a href="#åä¾‹ï¼šä¸éµå®ˆç§»åŠ¨è¯­ä¹‰" class="headerlink" title="åä¾‹ï¼šä¸éµå®ˆç§»åŠ¨è¯­ä¹‰"></a>åä¾‹ï¼šä¸éµå®ˆç§»åŠ¨è¯­ä¹‰</h4><p>ç§»åŠ¨è¯­ä¹‰åªæ˜¯è¯­è¨€ä¸Šçš„ä¸€ä¸ª <strong>æ¦‚å¿µ</strong>ï¼Œå…·ä½“æ˜¯å¦ç§»åŠ¨å¯¹è±¡çš„èµ„æºã€å¦‚ä½•ç§»åŠ¨å¯¹è±¡çš„èµ„æºï¼Œéƒ½éœ€è¦é€šè¿‡ç¼–å†™ä»£ç  <strong>å®ç°</strong>ã€‚è€Œç§»åŠ¨è¯­ä¹‰å¸¸å¸¸è¢« <strong>è¯¯è®¤ä¸º</strong>ï¼Œç¼–è¯‘å™¨ <strong>è‡ªåŠ¨ç”Ÿæˆ</strong> ç§»åŠ¨å¯¹è±¡æœ¬èº«çš„ä»£ç ï¼ˆ<a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#æ‹·è´çœç•¥" target="_blank" rel="noopener">Â§ 4</a> æ‹·è´çœç•¥ï¼‰ã€‚</p>
<p>ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸éµå®ˆç§»åŠ¨è¯­ä¹‰çš„ <code>bad_vec::bad_vec(bad_vec&amp;&amp; rhs)</code>ï¼Œæ‰§è¡Œæ‹·è´è¯­ä¹‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bad_vec::bad_vec(bad_vec&amp;&amp; rhs) : data_(<span class="keyword">new</span> T[rhs.size_]) &#123;</span><br><span class="line">  <span class="keyword">auto</span> &amp;lhs = *<span class="keyword">this</span>;</span><br><span class="line">  lhs.size_ = rhs.size_;</span><br><span class="line">  <span class="built_in">std</span>::copy_n(rhs.data_, rhs.size_, lhs.data_);  <span class="comment">// copy data</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œä¸€ä¸ª <code>bad_vec</code> å¯¹è±¡åœ¨è¢« <code>move</code> ç§»åŠ¨åä»ç„¶å¯ç”¨ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bad_vec&lt;<span class="keyword">int</span>&gt; v_old &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">auto</span> v_new = <span class="built_in">std</span>::move(v_old);</span><br><span class="line"></span><br><span class="line">v_old[<span class="number">0</span>] = v_new[<span class="number">3</span>];           <span class="comment">// ok, but odd :-)</span></span><br><span class="line">assert(v_old[<span class="number">0</span>] != v_new[<span class="number">0</span>]);</span><br><span class="line">assert(v_old[<span class="number">0</span>] == v_new[<span class="number">3</span>]);</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ä»£ç å¯ä»¥é‚£ä¹ˆå†™ï¼Œä½†æ˜¯åœ¨è¯­ä¹‰ä¸Šæœ‰é—®é¢˜ï¼šè¿›è¡Œäº†æ‹·è´æ“ä½œï¼Œè¿èƒŒäº†ç§»åŠ¨è¯­ä¹‰çš„åˆè¡·ã€‚</p>
<h3 id="æ‹·è´çœç•¥"><a href="#æ‹·è´çœç•¥" class="headerlink" title="æ‹·è´çœç•¥"></a>æ‹·è´çœç•¥</h3><p>å°½ç®¡ C++ å¼•å…¥äº†ç§»åŠ¨è¯­ä¹‰ï¼Œç§»åŠ¨çš„è¿‡ç¨‹ ä»æœ‰ä¼˜åŒ–çš„ç©ºé—´ â€”â€” ä¸å…¶è°ƒç”¨ä¸€æ¬¡ æ²¡æœ‰æ„ä¹‰çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¸å¦‚è®©ç¼–è¯‘å™¨ ç›´æ¥è·³è¿‡è¿™ä¸ªè¿‡ç¨‹ â€”â€” äºæ˜¯å°±æœ‰äº† <a href="https://en.cppreference.com/w/cpp/language/copy_elision" target="_blank" rel="noopener">æ‹·è´çœç•¥ <em>(copy elision)</em></a>ã€‚</p>
<p>ç„¶è€Œï¼Œå¾ˆå¤šäººä¼šæŠŠç§»åŠ¨è¯­ä¹‰å’Œæ‹·è´çœç•¥ <strong>æ··æ·†</strong>ï¼š</p>
<ul>
<li>ç§»åŠ¨è¯­ä¹‰æ˜¯ <strong>è¯­è¨€æ ‡å‡†</strong> æå‡ºçš„æ¦‚å¿µï¼Œé€šè¿‡ç¼–å†™éµå®ˆç§»åŠ¨è¯­ä¹‰çš„ ç§»åŠ¨æ„é€ å‡½æ•°ã€å³å€¼é™å®šæˆå‘˜å‡½æ•°ï¼Œ<strong>é€»è¾‘ä¸Š</strong> ä¼˜åŒ– <strong>å¯¹è±¡å†…èµ„æº</strong> çš„è½¬ç§»æµç¨‹</li>
<li>æ‹·è´çœç•¥æ˜¯ï¼ˆC++ 17 å‰ï¼‰éæ ‡å‡†çš„ <strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong>ï¼Œè·³è¿‡ç§»åŠ¨/æ‹·è´æ„é€ å‡½æ•°ï¼Œè®©ç¼–è¯‘å™¨ç›´æ¥åœ¨ <strong>ç§»åŠ¨åçš„å¯¹è±¡</strong> å†…å­˜ä¸Šï¼Œæ„é€  <strong>è¢«ç§»åŠ¨çš„å¯¹è±¡</strong>ï¼ˆä¾‹å¦‚ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#è¯¯è§£-ç§»åŠ¨éå¼•ç”¨è¿”å›å€¼" target="_blank" rel="noopener">Â§ 1.3</a> çš„ä»£ç ï¼Œç›´æ¥åœ¨ å‡½æ•°è¿”å›å€¼å¯¹è±¡ çš„å†…å­˜ä¸Šï¼Œæ„é€  å‡½æ•°å±€éƒ¨å¯¹è±¡ <code>ret</code> â€”â€” åœ¨ <strong>ä¸åŒä½œç”¨åŸŸ</strong> é‡Œï¼Œå…±äº« <strong>åŒä¸€å—å†…å­˜</strong>ï¼‰</li>
</ul>
<p>C++ 17 è¦æ±‚ç¼–è¯‘å™¨å¯¹ <strong>çº¯å³å€¼</strong> <em>(prvalue, pure rvalue)</em> è¿›è¡Œæ‹·è´çœç•¥ä¼˜åŒ–ã€‚ï¼ˆ<a href="https://jonasdevlieghere.com/guaranteed-copy-elision/" target="_blank" rel="noopener">å‚è€ƒ</a>ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Data <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Data val;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">throw</span> val;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> val;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// NRVO from lvalue to ret (not guaranteed)</span></span><br><span class="line">  <span class="comment">// if NRVO is disabled, move ctor is called</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(Date arg)</span></span>;</span><br><span class="line"></span><br><span class="line">Data v = f();     <span class="comment">// copy elision from prvalue (C++ 17)</span></span><br><span class="line">g(f());           <span class="comment">// copy elision from prvalue (C++ 17)</span></span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ– å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°æ—¶ï¼Œä¼ å…¥çš„çº¯å³å€¼å¯ä»¥ç¡®ä¿è¢«ä¼˜åŒ– â€”â€” Return Value Optimization <em>(RVO)</em>ï¼›è€Œè¿”å›çš„ <strong>å°†äº¡å€¼</strong> <em>(xvalue, eXpiring value)</em> ä¸ä¿è¯è¢«ä¼˜åŒ– â€”â€” Named Return Value Optimization <em>(NRVO)</em>ã€‚</p>
<h3 id="é€šç”¨å¼•ç”¨å’Œå®Œç¾è½¬å‘"><a href="#é€šç”¨å¼•ç”¨å’Œå®Œç¾è½¬å‘" class="headerlink" title="é€šç”¨å¼•ç”¨å’Œå®Œç¾è½¬å‘"></a>é€šç”¨å¼•ç”¨å’Œå®Œç¾è½¬å‘</h3><blockquote>
<p>æ­ç¤º <code>std::move()</code>/<code>std::forward()</code> çš„åŸç†ï¼Œéœ€è¦è¯»è€…æœ‰ä¸€å®šçš„ <strong>æ¨¡æ¿ç¼–ç¨‹åŸºç¡€</strong>ã€‚</p>
</blockquote>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨"><a href="#ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨"></a>ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨</h4><p>C++ 11 å¼•å…¥äº†å˜é•¿æ¨¡æ¿çš„æ¦‚å¿µï¼Œå…è®¸å‘æ¨¡æ¿å‚æ•°é‡Œä¼ å…¥ä¸åŒç±»å‹çš„ä¸å®šé•¿å¼•ç”¨å‚æ•°ã€‚ç”±äºæ¯ä¸ªç±»å‹å¯èƒ½æ˜¯å·¦å€¼å¼•ç”¨æˆ–å³å€¼å¼•ç”¨ï¼Œé’ˆå¯¹æ‰€æœ‰å¯èƒ½çš„å·¦å³å€¼å¼•ç”¨ç»„åˆï¼Œ<strong>ç‰¹åŒ–æ‰€æœ‰æ¨¡æ¿</strong> æ˜¯ <strong>ä¸ç°å®çš„</strong>ã€‚</p>
<p><strong>å‡è®¾æ²¡æœ‰</strong> é€šç”¨å¼•ç”¨çš„æ¦‚å¿µï¼Œæ¨¡æ¿ <a href="https://en.cppreference.com/w/cpp/memory/unique_ptr/make_unique" target="_blank" rel="noopener"><code>std::make_unique&lt;&gt;</code></a> è‡³å°‘éœ€è¦ä¸¤ä¸ªé‡è½½ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt; make_unique(<span class="keyword">const</span> Args&amp;... args) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">unique_ptr</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">new</span> T &#123; args... &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt; make_unique(Args&amp;&amp;... args) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">unique_ptr</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">new</span> T &#123; <span class="built_in">std</span>::move&lt;Args&gt;(args)... &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯¹äºä¼ å…¥çš„å·¦å€¼å¼•ç”¨ <code>const Args&amp;... args</code>ï¼Œåªè¦å±•å¼€ <code>args...</code> å°±å¯ä»¥è½¬å‘è¿™ä¸€ç»„å·¦å€¼å¼•ç”¨</li>
<li>å¯¹äºä¼ å…¥çš„å³å€¼å¼•ç”¨ <code>Args&amp;&amp;... args</code>ï¼Œéœ€è¦é€šè¿‡ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è½¬å‘" target="_blank" rel="noopener">Â§ 5.4</a> <code>std::move()</code> è½¬å‘å‡ºå»ï¼Œå³ <code>std::move(args)...</code>ï¼ˆä¸ºä»€ä¹ˆè¦è½¬å‘ï¼šå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#è¯¯è§£-ä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°" target="_blank" rel="noopener">Â§ 1.4</a>ï¼‰</li>
</ul>
<p>ä¸Šè¿°ä»£ç çš„é—®é¢˜åœ¨äºï¼šå¦‚æœä¼ å…¥çš„ <code>args</code> <strong>æ—¢æœ‰</strong> å·¦å€¼å¼•ç”¨ <strong>åˆæœ‰</strong> å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ¨¡æ¿éƒ½ <strong>æ— æ³•åŒ¹é…</strong>ã€‚</p>
<h4 id="é€šç”¨å¼•ç”¨"><a href="#é€šç”¨å¼•ç”¨" class="headerlink" title="é€šç”¨å¼•ç”¨"></a>é€šç”¨å¼•ç”¨</h4><blockquote>
<p>Item 24: Distinguish universal references from rvalue references. â€”â€” Scott Meyers, <em>Effective Modern C++</em></p>
</blockquote>
<p><a href="https://isocpp.org/blog/2012/11/universal-references-in-c11-scott-meyers" target="_blank" rel="noopener">Scott Meyers æŒ‡å‡º</a>ï¼šæœ‰æ—¶å€™ç¬¦å· <code>&amp;&amp;</code> å¹¶ä¸ä¸€å®šä»£è¡¨å³å€¼å¼•ç”¨ï¼Œå®ƒä¹Ÿå¯èƒ½æ˜¯å·¦å€¼å¼•ç”¨ â€”â€” å¦‚æœä¸€ä¸ªå¼•ç”¨ç¬¦å·éœ€è¦é€šè¿‡ å·¦å³å€¼ç±»å‹æ¨å¯¼ï¼ˆæ¨¡æ¿å‚æ•°ç±»å‹ æˆ– <code>auto</code> æ¨å¯¼ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªç¬¦å·å¯èƒ½æ˜¯å·¦å€¼å¼•ç”¨æˆ–å³å€¼å¼•ç”¨ â€”â€” è¿™å«åš <strong>é€šç”¨å¼•ç”¨</strong> <em>(universal reference)</em>ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rvalue ref: no type deduction</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f1</span><span class="params">(Widget&amp;&amp; param1)</span></span>;</span><br><span class="line">Widget&amp;&amp; var1 = Widget();</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">f2</span><span class="params">(<span class="built_in">vector</span>&lt;T&gt;&amp;&amp; param2)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// universal ref: type deduction</span></span><br><span class="line"><span class="keyword">auto</span>&amp;&amp; var2 = var1;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">f3</span><span class="params">(T&amp;&amp; param)</span></span>;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå‰ä¸‰ä¸ª <code>&amp;&amp;</code> ç¬¦å·ä¸æ¶‰åŠå¼•ç”¨ç¬¦å·çš„å·¦å³å€¼ç±»å‹æ¨å¯¼ï¼Œéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼›è€Œåä¸¤ä¸ª <code>&amp;&amp;</code> ç¬¦å·ä¼š <strong>æ ¹æ®åˆå§‹å€¼æ¨å¯¼å·¦å³å€¼ç±»å‹</strong>ï¼š</p>
<ul>
<li>å¯¹äº <code>var2</code>ï¼Œå› ä¸º <code>var1</code> æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ <code>var2</code> ä¹Ÿæ˜¯å·¦å€¼å¼•ç”¨<ul>
<li>æ¨å¯¼ä¸ä¼šå‚è€ƒ <code>var1</code> çš„å˜é‡ç±»å‹</li>
</ul>
</li>
<li>å¯¹äº <code>T&amp;&amp;</code>ï¼š<ul>
<li>å¦‚æœ <code>param</code> ä¼ å…¥å·¦å€¼ï¼Œ<code>T&amp;&amp;</code> æ˜¯å·¦å€¼å¼•ç”¨ <code>std::remove_reference_t&amp;</code></li>
<li>å¦‚æœ <code>param</code> ä¼ å…¥å³å€¼ï¼Œ<code>T&amp;&amp;</code> æ˜¯å³å€¼å¼•ç”¨ <code>std::remove_reference_t&amp;&amp;</code></li>
</ul>
</li>
</ul>
<p>åŸºäºé€šç”¨å¼•ç”¨ï¼Œ<a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨" target="_blank" rel="noopener">Â§ 5.1</a> çš„æ¨¡æ¿ <code>std::make_unique&lt;&gt;</code> åªéœ€è¦ä¸€ä¸ªé‡è½½ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="built_in">unique_ptr</span>&lt;T&gt; make_unique(Args&amp;&amp;... args) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">unique_ptr</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">new</span> T &#123; <span class="built_in">std</span>::forward&lt;Args&gt;(args)... &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>std::forward()</code> å®ç°äº† <strong>é’ˆå¯¹ä¸åŒå·¦å³å€¼å‚æ•°çš„è½¬å‘</strong> â€”â€” å®Œç¾è½¬å‘ã€‚</p>
<blockquote>
<p>è¿™é‡Œå°±æ˜¯å®Œç¾è½¬å‘çœŸæ­£çš„æ„ä¹‰æ‰€åœ¨ï¼Œä¼šå°†å½¢å‚çš„å¼•ç”¨ç±»å‹è½¬å‘å‡ºå»ã€‚</p>
</blockquote>
<h4 id="å®Œç¾è½¬å‘"><a href="#å®Œç¾è½¬å‘" class="headerlink" title="å®Œç¾è½¬å‘"></a>å®Œç¾è½¬å‘</h4><p>ä»€ä¹ˆæ˜¯ <strong>å®Œç¾è½¬å‘</strong> <em>(perfect forwarding)</em>ï¼š</p>
<ul>
<li>å¦‚æœå‚æ•°æ˜¯ <strong>å·¦å€¼å¼•ç”¨</strong>ï¼Œç›´æ¥ä»¥ <strong>å·¦å€¼å¼•ç”¨</strong> çš„å½¢å¼ï¼Œè½¬å‘ç»™ä¸‹ä¸€ä¸ªå‡½æ•°</li>
<li>å¦‚æœå‚æ•°æ˜¯ <strong>å³å€¼å¼•ç”¨</strong>ï¼Œè¦å…ˆ â€œè¿˜åŸâ€ ä¸º <strong>å³å€¼å¼•ç”¨</strong> çš„å½¢å¼ï¼Œå†è½¬å‘ç»™ä¸‹ä¸€ä¸ªå‡½æ•°</li>
</ul>
<p>å› æ­¤ï¼Œ<a href="https://en.cppreference.com/w/cpp/utility/forward" target="_blank" rel="noopener"><code>std::forward()</code></a> å®šä¹‰ä¸¤ä¸ª <strong>ä¸æ¶‰åŠ</strong> å·¦å³å€¼ç±»å‹ <strong>æ¨å¯¼</strong> çš„æ¨¡æ¿ï¼ˆä¸èƒ½ä½¿ç”¨ é€šç”¨å¼•ç”¨å‚æ•°ï¼‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T&amp;&amp; <span class="title">forward</span><span class="params">(<span class="built_in">std</span>::<span class="keyword">remove_reference_t</span>&lt;T&gt;&amp; val)</span> <span class="keyword">noexcept</span> </span>&#123;  <span class="comment">// #1</span></span><br><span class="line">  <span class="comment">// forward lvalue as either lvalue or rvalue</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;T&amp;&amp;&gt;(val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T&amp;&amp; <span class="title">forward</span><span class="params">(<span class="built_in">std</span>::<span class="keyword">remove_reference_t</span>&lt;T&gt;&amp;&amp; val)</span> <span class="keyword">noexcept</span> </span>&#123;  <span class="comment">// #2</span></span><br><span class="line">  <span class="comment">// forward rvalue as rvalue (not lvalue)</span></span><br><span class="line">  <span class="keyword">static_assert</span>(!<span class="built_in">std</span>::is_lvalue_reference_v&lt;T&gt;,</span><br><span class="line">                <span class="string">"Cannot forward rvalue as lvalue."</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;T&amp;&amp;&gt;(val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">å®å‚/è¿”å›å€¼</th>
<th style="text-align:center">é‡è½½</th>
<th style="text-align:center">l-ref è¿”å›å€¼</th>
<th style="text-align:center">r-ref è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">l-ref å®å‚</td>
<td style="text-align:center">#1</td>
<td style="text-align:center">å®Œç¾è½¬å‘</td>
<td style="text-align:center"><strong>ç§»åŠ¨è½¬å‘</strong></td>
</tr>
<tr>
<td style="text-align:center">r-ref å®å‚</td>
<td style="text-align:center">#2</td>
<td style="text-align:center"><strong>è¯­ä¹‰é”™è¯¯</strong></td>
<td style="text-align:center">å®Œç¾è½¬å‘</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>å°½ç®¡åˆå§‹åŒ–åçš„å˜é‡éƒ½æ˜¯ <strong>å·¦å€¼</strong>ï¼ˆå‚è€ƒ <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#è¯¯è§£-ä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°" target="_blank" rel="noopener">Â§ 1.4</a>ï¼‰ï¼Œä½†åŸå§‹çš„ <strong>å˜é‡ç±»å‹</strong> ä»ä¼šä¿ç•™</li>
<li>å› æ­¤ï¼Œå¯ä»¥æ ¹æ® <strong>å®å‚ç±»å‹</strong> é€‰æ‹©é‡è½½ï¼Œ<strong>å’Œæ¨¡æ¿å‚æ•° <code>T</code> çš„ç±»å‹æ— å…³</strong></li>
<li><strong>è¿”å›å€¼ç±»å‹</strong> <code>static_cast(val)</code> ç»è¿‡æ¨¡æ¿å‚æ•° <code>T&amp;&amp;</code> <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#å¼•ç”¨æŠ˜å " target="_blank" rel="noopener">Â§ 2.4</a> å¼•ç”¨æŠ˜å  å®ç° å®Œç¾è½¬å‘/ç§»åŠ¨è½¬å‘ï¼Œ<strong>å’Œå®å‚ç±»å‹æ— å…³</strong></li>
<li>â€œå°† l-ref å®å‚ è½¬å‘ä¸º r-ref è¿”å›å€¼â€ ç­‰ä»·äº <a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference#ç§»åŠ¨è½¬å‘" target="_blank" rel="noopener">Â§ 5.4</a> <code>std::move()</code> ç§»åŠ¨è½¬å‘</li>
</ul>
<h4 id="ç§»åŠ¨è½¬å‘"><a href="#ç§»åŠ¨è½¬å‘" class="headerlink" title="ç§»åŠ¨è½¬å‘"></a>ç§»åŠ¨è½¬å‘</h4><p>ç±»ä¼¼çš„ï¼Œ<a href="https://en.cppreference.com/w/cpp/utility/move" target="_blank" rel="noopener"><code>std::move()</code></a> åªè½¬å‘ä¸ºå³å€¼å¼•ç”¨ç±»å‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="built_in">std</span>::<span class="keyword">remove_reference_t</span>&lt;T&gt;&amp;&amp; move(T&amp;&amp; val) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">  <span class="comment">// forward either lvalue or rvalue as rvalue</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="built_in">std</span>::<span class="keyword">remove_reference_t</span>&lt;T&gt;&amp;&amp;&gt;(val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">å®å‚/è¿”å›å€¼</th>
<th style="text-align:center">r-ref è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">l-ref å®å‚</td>
<td style="text-align:center">ç§»åŠ¨è½¬å‘</td>
</tr>
<tr>
<td style="text-align:center">r-ref å®å‚</td>
<td style="text-align:center">ç§»åŠ¨è½¬å‘ï¼ˆå®Œç¾è½¬å‘ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>æ¥å— é€šç”¨å¼•ç”¨æ¨¡æ¿å‚æ•° <code>T&amp;&amp;</code>ï¼ˆæ— éœ€ä¸¤ä¸ªæ¨¡æ¿ï¼Œä½¿ç”¨æ—¶ä¸åŒºåˆ† <code>T</code> çš„å¼•ç”¨ç±»å‹ï¼‰</li>
<li>è¿”å›å€¼ <code>static_cast&amp;&amp;&gt;(val)</code> å°†å®å‚ <strong>è½¬ä¸ºå°†äº¡å€¼</strong>ï¼ˆå³å€¼å¼•ç”¨ç±»å‹ï¼‰</li>
<li>æ‰€ä»¥ <code>std::move()</code> ç­‰ä»·äº <code>std::forward&amp;&amp;&gt;()</code></li>
</ul>
<p>æœ€åï¼Œ<code>std::move()</code>/<code>std::forward()</code> åªæ˜¯ç¼–è¯‘æ—¶çš„å˜é‡ç±»å‹è½¬æ¢ï¼Œä¸ä¼šäº§ç”Ÿç›®æ ‡ä»£ç ã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li>åŸæ–‡é“¾æ¥ï¼š<a href="https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference" target="_blank" rel="noopener">https://bot-man-jl.github.io/articles/?post=2018/Cpp-Rvalue-Reference</a></li>
</ul>

    </div>

    
    
    
        
      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>murphypei</li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://murphypei.github.io/blog/2020/02/right-reference.html" title="C++ å³å€¼å¼•ç”¨ä½¿ç”¨æ€»ç»“">https://murphypei.github.io/blog/2020/02/right-reference.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/C-11/" rel="tag"># C++11</a>
            
              <a href="/tags/å³å€¼å¼•ç”¨/" rel="tag"># å³å€¼å¼•ç”¨</a>
            
              <a href="/tags/ç§»åŠ¨/" rel="tag"># ç§»åŠ¨</a>
            
              <a href="/tags/å®Œç¾è½¬å‘/" rel="tag"># å®Œç¾è½¬å‘</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/blog/2020/02/thread-local.html" rel="next" title="C++11 thread_local ç”¨æ³•">
                  <i class="fa fa-chevron-left"></i> C++11 thread_local ç”¨æ³•
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/blog/2020/03/call-derived-function.html" rel="prev" title="çˆ¶ç±»æˆå‘˜å‡½æ•°è°ƒç”¨å­ç±»æˆå‘˜å‡½æ•°">
                  çˆ¶ç±»æˆå‘˜å‡½æ•°è°ƒç”¨å­ç±»æˆå‘˜å‡½æ•° <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#å†™åœ¨å‰é¢"><span class="nav-number">1.</span> <span class="nav-text">å†™åœ¨å‰é¢</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯¯è§£1ï¼šè¿”å›å‰ï¼Œç§»åŠ¨å±€éƒ¨å˜é‡"><span class="nav-number">1.1.</span> <span class="nav-text">è¯¯è§£1ï¼šè¿”å›å‰ï¼Œç§»åŠ¨å±€éƒ¨å˜é‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯¯è§£2ï¼šè¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨"><span class="nav-number">1.2.</span> <span class="nav-text">è¯¯è§£2ï¼šè¢«ç§»åŠ¨çš„å€¼ä¸èƒ½å†ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯¯è§£3ï¼šç§»åŠ¨éå¼•ç”¨è¿”å›å€¼"><span class="nav-number">1.3.</span> <span class="nav-text">è¯¯è§£3ï¼šç§»åŠ¨éå¼•ç”¨è¿”å›å€¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯¯è§£4ï¼šä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°"><span class="nav-number">1.4.</span> <span class="nav-text">è¯¯è§£4ï¼šä¸ç§»åŠ¨å³å€¼å¼•ç”¨å‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯¯è§£5ï¼šæ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°"><span class="nav-number">1.5.</span> <span class="nav-text">è¯¯è§£5ï¼šæ‰‹å†™é”™è¯¯çš„ç§»åŠ¨æ„é€ å‡½æ•°</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŸºç¡€çŸ¥è¯†"><span class="nav-number">2.</span> <span class="nav-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å€¼ç±»åˆ«-vs-å˜é‡ç±»å‹"><span class="nav-number">2.1.</span> <span class="nav-text">å€¼ç±»åˆ« vs å˜é‡ç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å·¦å€¼å¼•ç”¨-vs-å³å€¼å¼•ç”¨-vs-å¸¸å¼•ç”¨"><span class="nav-number">2.2.</span> <span class="nav-text">å·¦å€¼å¼•ç”¨ vs å³å€¼å¼•ç”¨ vs å¸¸å¼•ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§"><span class="nav-number">2.3.</span> <span class="nav-text">å¼•ç”¨å‚æ•°é‡è½½ä¼˜å…ˆçº§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¼•ç”¨æŠ˜å "><span class="nav-number">2.4.</span> <span class="nav-text">å¼•ç”¨æŠ˜å </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç§»åŠ¨è¯­ä¹‰"><span class="nav-number">3.</span> <span class="nav-text">ç§»åŠ¨è¯­ä¹‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#é¿å…å…ˆæ‹·è´å†é‡Šæ”¾èµ„æº"><span class="nav-number">3.1.</span> <span class="nav-text">é¿å…å…ˆæ‹·è´å†é‡Šæ”¾èµ„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è½¬ç§»ä¸å¯æ‹·è´çš„èµ„æº"><span class="nav-number">3.2.</span> <span class="nav-text">è½¬ç§»ä¸å¯æ‹·è´çš„èµ„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åä¾‹ï¼šä¸éµå®ˆç§»åŠ¨è¯­ä¹‰"><span class="nav-number">3.3.</span> <span class="nav-text">åä¾‹ï¼šä¸éµå®ˆç§»åŠ¨è¯­ä¹‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ‹·è´çœç•¥"><span class="nav-number">4.</span> <span class="nav-text">æ‹·è´çœç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é€šç”¨å¼•ç”¨å’Œå®Œç¾è½¬å‘"><span class="nav-number">5.</span> <span class="nav-text">é€šç”¨å¼•ç”¨å’Œå®Œç¾è½¬å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨"><span class="nav-number">5.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆéœ€è¦é€šç”¨å¼•ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é€šç”¨å¼•ç”¨"><span class="nav-number">5.2.</span> <span class="nav-text">é€šç”¨å¼•ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®Œç¾è½¬å‘"><span class="nav-number">5.3.</span> <span class="nav-text">å®Œç¾è½¬å‘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç§»åŠ¨è½¬å‘"><span class="nav-number">5.4.</span> <span class="nav-text">ç§»åŠ¨è½¬å‘</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚è€ƒèµ„æ–™"><span class="nav-number">6.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar_128.ico"
      alt="murphypei">
  <p class="site-author-name" itemprop="name">murphypei</p>
  <div class="site-description" itemprop="description">è™šæ€€è‹¥è°·ï¼Œå¤§æ™ºè‹¥æ„š</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">444</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/murphypei" title="GitHub &rarr; https://github.com/murphypei" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:murphypei47@gmail.com" title="E-Mail &rarr; mailto:murphypei47@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.zhihu.com/people/guo-jia-66-80/activities" title="https://www.zhihu.com/people/guo-jia-66-80/activities" rel="noopener" target="_blank">çŸ¥ä¹</a>
        </li>
      
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">murphypei</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">605k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">16:49</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/muse.js?v=7.3.0"></script>

<script src="/js/next-boot.js?v=7.3.0"></script>



  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>





















  

  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'e14928c5d4e586a1be33',
      clientSecret: 'b58488475e69824177de7fa4e52325a0de1dbdb7',
      repo: 'murphypei.github.io',
      owner: 'murphypei',
      admin: ['murphypei'],
      id: '7640d0bbfbcaedc8d69a783ac3fe8ea7',
        language: 'zh-CN',
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/haru01.model.json"},"display":{"position":"left","width":250,"height":400},"mobile":{"show":false}});</script></body>
</html>
